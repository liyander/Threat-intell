const axios = require('axios');

const API_KEY = 'b5d985fc19d88b867e49433b42a09a86c92baec7367eb5e8';
const BASE_URL = 'https://mb-api.abuse.ch/api/v1/';

const getRecentMalware = async () => {
    try {
        const formData = new URLSearchParams();
        formData.append('query', 'recent_detections');
        // formData.append('selector', '100'); // Note: 'recent_detections' doesn't use selector, 'get_recent' does. 
        // User asked for #recent_detections, so we use query=recent_detections.
        
        const response = await axios.post(BASE_URL, formData, {
            headers: {
                'Auth-Key': API_KEY,
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        });

        if (response.data.query_status === 'ok') {
            return response.data.data;
        } else {
            console.error('MalwareBazaar API Error:', response.data.query_status);
            return [];
        }
    } catch (error) {
        console.error('Error fetching MalwareBazaar data:', error.message);
        return [];
    }
};

module.exports = {
    getRecentMalware
};
